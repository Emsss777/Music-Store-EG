<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" th:href="@{/css/common.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/made-order.css}">
    <title>Order Confirmation | Music Store</title>
</head>

<body>

<th:block th:replace="~{fragments/header :: site-header}"></th:block>

<main class="main-content">
    <section class="order-confirmation-section">
        <div class="container">
            <div class="order-header">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h1>Order Placed Successfully!</h1>
                <p class="order-subtitle">
                    Thank you for your purchase. Your order has been confirmed
                    and will be processed shortly.
                </p>
            </div>

            <div class="order-details-grid">
                <div class="order-info-card card">
                    <h2 class="card-title">Order Information</h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Order Number:</span>
                            <span class="info-value" th:text="${order.orderNumber}"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Order Date:</span>
                            <span class="info-value"
                                  th:text="${#temporals.format(order.createdOn, 'dd MMM, yyyy - HH:mm')}"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Order Status:</span>
                            <span class="info-value status-confirmed" th:text="${order.status}"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Payment Method:</span>
                            <span class="info-value" th:text="${order.paymentMethod}"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Total Amount:</span>
                            <span class="info-value total-amount"
                                  th:text="${#numbers.formatDecimal(order.totalAmount, 1, 2)} + ' €'">
                            </span>
                        </div>
                    </div>
                </div>

                <div class="shipping-info-card card">
                    <h2 class="card-title">Shipping Information</h2>
                    <div class="shipping-address">
                        <p class="address-name"
                           th:text="${order.owner.firstName + ' ' + order.owner.lastName}"></p>
                        <p class="address-line" th:text="${order.owner.email}"></p>
                        <p class="address-line">Digital Download</p>
                        <p class="address-line">No physical shipping required</p>
                    </div>
                    <div class="shipping-method">
                        <span class="shipping-label">Delivery Method:</span>
                        <span class="shipping-value">Digital Download (Instant)</span>
                    </div>
                    <div class="estimated-delivery">
                        <span class="delivery-label">Delivery Status:</span>
                        <span class="delivery-value">Available immediately after purchase</span>
                    </div>
                </div>
            </div>

            <div class="order-items-section">
                <h2 class="section-title">Order Items</h2>
                <div class="items-list">
                    <div class="order-item" th:each="item : ${order.items}">
                        <div class="item-image">
                            <img th:src="@{/images/album-covers/{imageName}(imageName=${item.album.coverUrl})}"
                                 alt="Album Cover">
                        </div>
                        <div class="item-details">
                            <h3 class="item-title" th:text="${item.album.title}"></h3>
                            <p class="item-artist"
                               th:text="${item.album.artist.firstName + ' ' + item.album.artist.lastName}"></p>
                            <p class="item-format">Digital Download</p>
                        </div>
                        <div class="item-quantity">
                            <span class="quantity">Qty: 1</span>
                        </div>
                        <div class="item-price">
                            <span class="summary-value"
                                  th:text="${#numbers.formatDecimal(item.unitPrice, 1, 2)} + ' €'">
                            </span>
                        </div>
                    </div>
                </div>

                <div class="order-summary">
                    <div class="summary-row">
                        <span class="summary-label">Subtotal:</span>
                        <span class="summary-value"
                              th:text="${#numbers.formatDecimal(order.totalAmount, 1, 2)} + ' €'">
                        </span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Shipping:</span>
                        <span class="summary-value">0,00 €</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Tax:</span>
                        <span class="summary-value">0,00 €</span>
                    </div>
                    <div class="summary-row total-row">
                        <span class="summary-label">Total:</span>
                        <span class="summary-value"
                              th:text="${#numbers.formatDecimal(order.totalAmount, 1, 2)} + ' €'">
                        </span>
                    </div>
                </div>
            </div>

            <div class="order-actions">
                <div class="action-buttons">
                    <a th:href="@{/users/my-orders}" class="button primary">View My Orders</a>
                    <a th:href="@{/catalog}" class="button secondary">Continue Shopping</a>
                    <button class="button download-receipt" onclick="downloadReceipt()">Download Receipt</button>
                </div>
            </div>

            <div class="order-timeline">
                <h2 class="section-title">Order Timeline</h2>
                <div class="timeline">
                    <div class="timeline-item completed">
                        <div class="timeline-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="timeline-content">
                            <h4>Order Placed</h4>
                            <p>Your order has been successfully placed</p>
                            <span class="timeline-date"
                                  th:text="${#temporals.format(order.createdOn, 'dd MMM, yyyy - HH:mm')}"></span>
                        </div>
                    </div>

                    <div class="timeline-item completed">
                        <div class="timeline-icon">
                            <i class="fas fa-credit-card"></i>
                        </div>
                        <div class="timeline-content">
                            <h4>Payment Processed</h4>
                            <p>Payment has been successfully processed</p>
                            <span class="timeline-date"
                                  th:text="${#temporals.format(order.createdOn, 'dd MMM, yyyy - HH:mm')}"></span>
                        </div>
                    </div>

                    <div class="timeline-item current">
                        <div class="timeline-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="timeline-content">
                            <h4>Processing</h4>
                            <p>Your order is being prepared for shipment</p>
                            <span class="timeline-date">In Progress</span>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-icon">
                            <i class="fas fa-shipping-fast"></i>
                        </div>
                        <div class="timeline-content">
                            <h4>Shipped</h4>
                            <p>Your order has been shipped</p>
                            <span class="timeline-date">Estimated: 17 jan, 2025</span>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <div class="timeline-content">
                            <h4>Delivered</h4>
                            <p>Your order has been delivered</p>
                            <span class="timeline-date">Estimated: 22–24 jan, 2025</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="support-section">
                <div class="support-card card">
                    <h3>Need Help?</h3>
                    <p>If you have any questions about your order, our customer support team is here to help.</p>
                    <div class="support-actions">
                        <a href="/contact" class="button support-button">Contact Support</a>
                        <a href="/help" class="button support-button">Help Center</a>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<th:block th:replace="~{fragments/footer :: site-footer}"></th:block>

<script>
    function downloadReceipt() {
        alert('Receipt download started! Check your downloads folder.');

        const orderNumber = /*[[${order.orderNumber}]]*/ 'ORD-12345678';
        const orderDate = /*[[${#temporals.format(order.createdOn, 'dd MMM, yyyy')}]]*/ '15 яну, 2025';
        const orderStatus = /*[[${order.status}]]*/ 'Confirmed';
        const orderTotal = /*[[${#numbers.formatCurrency(order.totalAmount)} + '€']]*/ '28,98 €';
        const customerName = /*[[${order.owner.firstName + ' ' + order.owner.lastName}]]*/ 'Emil Ganchev';
        const customerEmail = /*[[${order.owner.email}]]*/ 'admin@softuni.bg';

        const receiptData = `
                MUSIC STORE APP - RECEIPT
                =========================

                Order Number: ${orderNumber}
                Date: ${orderDate}
                Status: ${orderStatus}

                CUSTOMER INFORMATION:
                ${customerName}
                ${customerEmail}

                ORDER ITEMS:
                ${Array.from(document.querySelectorAll('.order-item')).map(item => {
            const title = item.querySelector('.item-title').textContent;
            const artist = item.querySelector('.item-artist').textContent;
            const price = item.querySelector('.price').textContent;
            return `1x ${title} - ${artist} - ${price}`;
        }).join('\n')}

                SUMMARY:
                Subtotal: ${orderTotal}
                Shipping: $0.00
                Tax: $0.00
                Total: ${orderTotal}

                Payment Method: Digital Download

                Thank you for your purchase!
            `;

        const blob = new Blob([receiptData], {type: 'text/plain'});
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'music-store-receipt-' + orderNumber + '.txt';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
    }

    document.addEventListener('DOMContentLoaded', function () {
        // Animate timeline items on scroll
        const timelineItems = document.querySelectorAll('.timeline-item');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateX(0)';
                }
            });
        });

        timelineItems.forEach(item => {
            item.style.opacity = '0';
            item.style.transform = 'translateX(-20px)';
            item.style.transition = 'all 0.6s ease';
            observer.observe(item);
        });
    });
</script>

</body>

</html>
