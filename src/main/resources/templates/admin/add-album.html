<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
          rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" th:href="@{/css/common.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/admin/add-album.css}">
    <title>Add New Album | Music Store</title>
</head>

<body>

<th:block th:replace="~{fragments/header :: site-header}"></th:block>

<main>
    <div class="admin-header">
        <div class="container">
            <div class="breadcrumb">
                <a th:href="@{/admin/admin-dashboard}">Admin Dashboard</a> /
                <a th:href="@{/admin/albums}">Albums</a> /
                <span>Add New Album</span>
            </div>
            <h1 class="page-title">Add New Album</h1>
            <p class="page-subtitle">Create a new album entry for the music catalog</p>
        </div>
    </div>

    <section class="add-album-section">
        <div class="container">
            <div class="form-layout">
                <div class="form-container">
                    <form class="album-form" id="albumForm"
                          th:method="POST" th:action="@{/admin/albums/add}" th:object="${saveAlbumDTO}">
                        <div class="form-section">
                            <h2 class="section-title">Album Information</h2>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="title">Album Title *</label>
                                    <input type="text" id="title" th:field="*{title}"
                                           placeholder="Enter album title" required>
                                    <div class="error-message"
                                         th:if="${#fields.hasErrors('title')}" th:errors="*{title}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="artistId">Artist *</label>
                                    <div class="artist-selection">
                                        <select id="artistId" th:field="*{artistId}" required>
                                            <option value="">Select artist</option>
                                            <option th:each="artist : ${artists}"
                                                    th:value="${artist.id}"
                                                    th:text="${artist.artistName}">
                                            </option>
                                        </select>
                                        <a class="add-artist-btn" target="_blank" th:href="@{/admin/artists/add}">
                                            <span class="btn-icon">+</span>
                                            Add New Artist
                                        </a>
                                    </div>
                                    <div class="error-message"
                                         th:if="${#fields.hasErrors('artistId')}" th:errors="*{artistId}">
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="genre">Genre *</label>
                                    <select id="genre" th:field="*{genre}" required>
                                        <option value="">Select genre</option>
                                        <option th:each="genre : ${genres}"
                                                th:value="${genre}"
                                                th:text="${#strings.capitalize(
                                                #strings.replace(#strings.toLowerCase(genre), '_', ' '))}">
                                        </option>
                                    </select>
                                    <div class="error-message"
                                         th:if="${#fields.hasErrors('genre')}" th:errors="*{genre}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="year">Release Year *</label>
                                    <input type="number" id="year" th:field="*{year}"
                                           max="2025" placeholder="2024" required>
                                    <div class="error-message"
                                         th:if="${#fields.hasErrors('year')}" th:errors="*{year}">
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="description">Album Description</label>
                                <textarea id="description" th:field="*{description}"
                                          rows="4"
                                          placeholder="Describe the album's concept, themes, and musical style...">
                                </textarea>
                                <div class="error-message"
                                     th:if="${#fields.hasErrors('description')}" th:errors="*{description}">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2 class="section-title">Media & Artwork</h2>

                            <div class="form-group">
                                <label for="coverUrl">Album Cover URL *</label>
                                <input type="url" id="coverUrl" th:field="*{coverUrl}"
                                       placeholder="https://example.com/album-cover.jpg" required>
                                <div class="error-message"
                                     th:if="${#fields.hasErrors('coverUrl')}" th:errors="*{coverUrl}">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="albumDuration">Duration (minutes)</label>
                                    <input type="number" id="albumDuration" name="albumDuration"
                                           min="1" max="300" placeholder="45">
                                </div>
                                <div class="form-group">
                                    <label for="trackCount">Number of Tracks</label>
                                    <input type="number" id="trackCount" name="trackCount"
                                           min="1" max="50" placeholder="12">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2 class="section-title">Pricing & Availability</h2>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="price">Price (EUR) *</label>
                                    <input type="number" id="price" th:field="*{price}"
                                           step="0.01" min="0" placeholder="12,99" required>
                                    <div class="error-message"
                                         th:if="${#fields.hasErrors('price')}" th:errors="*{price}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="originalPrice">Original Price (if on sale)</label>
                                    <input type="number" id="originalPrice" name="originalPrice"
                                           step="0.01" min="0" placeholder="15,99">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="albumStatus">Status</label>
                                    <select id="albumStatus" name="albumStatus">
                                        <option value="active">Active</option>
                                        <option value="inactive">Inactive</option>
                                        <option value="coming-soon">Coming Soon</option>
                                        <option value="pre-order">Pre-order</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="featured">Featured Album</label>
                                    <select id="featured" name="featured">
                                        <option value="no">No</option>
                                        <option value="yes">Yes</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-container">
                                    <input type="checkbox" id="newRelease" name="newRelease">
                                    <span class="checkmark"></span>
                                    Mark as New Release
                                </label>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2 class="section-title">Track Listing</h2>

                            <div class="track-list" id="trackList">
                                <div class="track-item">
                                    <div class="track-number">1</div>

                                    <label for="trackTitle1" class="sr-only">Track title</label>
                                    <input type="text" id="trackTitle1" name="trackTitles[]"
                                           placeholder="Track title" class="track-title-input">

                                    <label for="trackDuration1" class="sr-only">Track duration</label>
                                    <input type="text" id="trackDuration1" name="trackDurations[]"
                                           placeholder="3:45" class="track-duration-input">

                                    <button type="button" class="remove-track-btn" onclick="removeTrack(this)">Ã—
                                    </button>
                                </div>
                            </div>

                            <button type="button" class="add-track-btn" onclick="addTrack()">+ Add Track</button>
                        </div>

                        <div class="form-section">
                            <h2 class="section-title">Additional Information</h2>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="label">Record Label</label>
                                    <input type="text" id="label" name="label"
                                           placeholder="Enter record label">
                                </div>
                                <div class="form-group">
                                    <label for="producer">Producer</label>
                                    <input type="text" id="producer" name="producer"
                                           placeholder="Enter producer name">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="tags">Tags (comma-separated)</label>
                                <input type="text" id="tags" name="tags"
                                       placeholder="indie, alternative, acoustic">
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="button secondary" onclick="resetForm()">Reset Form
                            </button>
                            <button type="button" class="button" onclick="saveDraft()">Save Draft</button>
                            <button type="submit" class="button primary">Create Album</button>
                        </div>
                    </form>
                </div>

                <div class="form-sidebar">
                    <div class="preview-card card">
                        <h3>Album Preview</h3>
                        <div class="album-preview">
                            <div class="preview-cover">
                                <img id="previewCover"
                                     src="https://via.placeholder.com/200x200/746ab0/ffffff?text=Album+Cover"
                                     alt="Album Preview">
                                <div class="new-release-badge" id="newReleaseBadge" style="display: none;">NEW
                                </div>
                            </div>
                            <div class="preview-info">
                                <h4 id="previewTitle">Album Title</h4>
                                <p id="previewArtist">Artist Name</p>
                                <p id="previewGenre">Genre â€¢ 2024</p>
                                <div class="preview-price">
                                    <span id="previewPrice">12,99 â‚¬</span>
                                    <span id="previewOriginalPrice" style="display: none;"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="help-card card">
                        <h3>ðŸ’¡ Tips</h3>
                        <ul class="help-list">
                            <li>Use high-resolution cover art (minimum 1000x1000px)</li>
                            <li>Write compelling descriptions to attract listeners</li>
                            <li>Set competitive pricing based on market research</li>
                            <li>Add all tracks for the complete album experience</li>
                            <li>Use relevant tags for better discoverability</li>
                        </ul>
                    </div>

                    <div class="stats-card card">
                        <h3>ðŸ“Š Quick Stats</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-label">Total Albums</span>
                                <span class="stat-value">1,247</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">This Month</span>
                                <span class="stat-value">+23</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Avg. Price</span>
                                <span class="stat-value">13,45 â‚¬</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<th:block th:replace="~{fragments/footer :: site-footer}"></th:block>

<script>
    let trackCount = 1;

    function updatePreview() {
        const title = document.getElementById('title').value || 'Album Title';
        const artist = document.getElementById('artistId').selectedOptions[0]?.text || 'Artist Name';
        const genre = document.getElementById('genre').value || 'Genre';
        const year = document.getElementById('year').value || '2024';
        const price = document.getElementById('price').value || '12.99';
        const originalPrice = document.getElementById('originalPrice').value;
        const cover = document.getElementById('coverUrl').value ||
            'https://via.placeholder.com/200x200/746ab0/ffffff?text=Album+Cover';
        const isNewRelease = document.getElementById('newRelease').checked;

        document.getElementById('previewTitle').textContent = title;
        document.getElementById('previewArtist').textContent = artist;
        document.getElementById('previewGenre').textContent = `${genre} â€¢ ${year}`;
        document.getElementById('previewPrice').textContent = `$${price}`;
        document.getElementById('previewCover').src = cover;

        const originalPriceElement = document.getElementById('previewOriginalPrice');
        if (originalPrice) {
            originalPriceElement.textContent = `$${originalPrice}`;
            originalPriceElement.style.display = 'inline';
            originalPriceElement.style.textDecoration = 'line-through';
            originalPriceElement.style.color = 'rgba(255, 255, 255, 0.5)';
            originalPriceElement.style.marginLeft = '8px';
        } else {
            originalPriceElement.style.display = 'none';
        }

        const newReleaseBadge = document.getElementById('newReleaseBadge');
        newReleaseBadge.style.display = isNewRelease ? 'block' : 'none';
    }

    function addTrack() {
        trackCount++;
        const trackList = document.getElementById('trackList');
        const trackItem = document.createElement('div');
        trackItem.className = 'track-item';
        trackItem.innerHTML = `
                <div class="track-number">${trackCount}</div>
                <input type="text" name="trackTitles[]" placeholder="Track title" class="track-title-input">
                <input type="text" name="trackDurations[]" placeholder="3:45" class="track-duration-input">
                <button type="button" class="remove-track-btn" onclick="removeTrack(this)">Ã—</button>
            `;
        trackList.appendChild(trackItem);
    }

    function removeTrack(button) {
        const trackItem = button.parentElement;
        trackItem.remove();
        updateTrackNumbers();
    }

    function updateTrackNumbers() {
        const trackItems = document.querySelectorAll('.track-item');
        trackItems.forEach((item, index) => {
            item.querySelector('.track-number').textContent = $(index + 1);
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        const previewFields = ['title', 'artistId', 'genre', 'year', 'price', 'originalPrice', 'coverUrl', 'newRelease'];
        previewFields.forEach(field => {
            const element = document.getElementById(field);
            if (element) {
                element.addEventListener('input', updatePreview);
                element.addEventListener('change', updatePreview);
            }
        });
    });

    function resetForm() {
        if (confirm('Are you sure you want to reset the form? All data will be lost.')) {
            document.getElementById('albumForm').reset();
            updatePreview();
            const trackList = document.getElementById('trackList');
            trackList.innerHTML = `
                    <div class="track-item">
                        <div class="track-number">1</div>
                        <input type="text" name="trackTitles[]" placeholder="Track title" class="track-title-input">
                        <input type="text" name="trackDurations[]" placeholder="3:45" class="track-duration-input">
                        <button type="button" class="remove-track-btn" onclick="removeTrack(this)">Ã—</button>
                    </div>
                `;
            trackCount = 1;
        }
    }

    function saveDraft() {
        alert('Draft saved successfully!');
    }
</script>

</body>

</html>
