<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
          rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" th:href="@{/css/common.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/order-details.css}">
    <title th:text="'Order Details #' + ${order.orderNumber} + ' | Music Store'"></title>
</head>

<body>

<th:block th:replace="~{fragments/header :: site-header}"></th:block>

<main>
    <div class="order-details-header">
        <div class="container">
            <div class="breadcrumb">
                <a th:href="@{/users/my-orders}">My Orders</a> /
                <span th:text="'Order #' + ${order.orderNumber}"></span>
            </div>
            <h1 class="page-title">Order Details</h1>
            <p class="page-subtitle"
               th:text="'Order #' + ${order.orderNumber} + ' • ' + ${#temporals.format(
               order.createdOn, 'dd MMM, yyyy')}"></p>
        </div>
    </div>

    <section class="order-details-section">
        <div class="container">
            <div class="order-details-layout">
                <div class="order-summary-card card">
                    <div class="card-header">
                        <h2>Order Summary</h2>
                        <span class="status-badge"
                              th:classappend="${order.status.name().toLowerCase()}"
                              th:text="${order.status.name()}"></span>
                    </div>

                    <div class="order-info">
                        <div class="info-row">
                            <span class="info-label">Order Number</span>
                            <span class="info-value" th:text="'#' + ${order.orderNumber}"></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Order Date</span>
                            <span class="info-value"
                                  th:text="${#temporals.format(order.createdOn, 'dd MMM, yyyy')}"></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Payment Method</span>
                            <span class="info-value" th:text="${order.paymentMethod.name()}"></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Total Amount</span>
                            <span class="info-value total"
                                  th:text="${#numbers.formatDecimal(order.totalAmount, 1, 2)} + ' €'">
                            </span>
                        </div>
                    </div>
                </div>

                <div class="order-items-card card">
                    <div class="card-header">
                        <h2>Ordered Items</h2>
                        <button class="download-all-btn"
                                th:if="${order.status.name() == 'COMPLETED'}">Download All
                        </button>
                    </div>

                    <div class="items-list">
                        <div th:each="item : ${order.items}" class="order-item">
                            <div class="item-image">
                                <img th:src="${item.album.coverUrl}"
                                     th:alt="${item.album.title}"
                                     src="https://via.placeholder.com/100x100/746ab0/ffffff?text=Album">
                            </div>
                            <div class="item-details">
                                <h3 class="item-title" th:text="${item.album.title}"></h3>
                                <p class="item-artist" th:text="${item.album.artist.artistName}"></p>
                                <div class="item-meta">
                                    <span class="item-genre" th:text="${item.album.genre.name()}"></span>
                                    <span class="item-year" th:text="${item.album.year}"></span>
                                </div>
                                <div class="item-price"
                                     th:text="${#numbers.formatDecimal(item.unitPrice, 1, 2)} + ' €'">
                                </div>
                            </div>
                            <div class="item-actions">
                                <button class="download-btn primary"
                                        th:if="${order.status.name() == 'COMPLETED'}">Download
                                </button>
                                <button class="download-btn" disabled
                                        th:if="${order.status.name() == 'PENDING'}">Processing
                                </button>
                                <a class="view-btn" th:href="@{/album/{id}(id=${item.album.id})}">View Album</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="billing-info-card card">
                    <div class="card-header">
                        <h2>Billing Information</h2>
                    </div>

                    <div class="billing-details">
                        <div class="billing-section">
                            <h3>Customer Information</h3>
                            <div class="address-info">
                                <p th:text="${order.owner.firstName + ' ' + order.owner.lastName}"></p>
                                <p th:text="${order.owner.email}"></p>
                            </div>
                        </div>

                        <div class="billing-section">
                            <h3>Payment Details</h3>
                            <div class="payment-info">
                                <p th:text="${order.paymentMethod.name()}"></p>
                                <p th:text="'Order Total: ' +
                                   ${#numbers.formatDecimal(order.totalAmount, 1, 2)} + ' €'">
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="order-timeline-card card">
                    <div class="card-header">
                        <h2>Order Timeline</h2>
                    </div>

                    <div class="timeline">
                        <div class="timeline-item completed">
                            <div class="timeline-marker"></div>
                            <div class="timeline-content">
                                <h4>Order Placed</h4>
                                <p>Your order has been successfully placed</p>
                                <span class="timeline-date"
                                      th:text="${#temporals.format(order.createdOn, 'dd MMM, yyyy - HH:mm')}">
                                </span>
                            </div>
                        </div>

                        <div class="timeline-item completed">
                            <div class="timeline-marker"></div>
                            <div class="timeline-content">
                                <h4>Payment Processed</h4>
                                <p>Payment has been successfully processed</p>
                                <span class="timeline-date"
                                      th:text="${#temporals.format(order.createdOn, 'dd MMM, yyyy - HH:mm')}">
                                </span>
                            </div>
                        </div>

                        <div class="timeline-item"
                             th:classappend="${order.status.name() == 'COMPLETED'} ? 'completed' : ''">
                            <div class="timeline-marker"></div>
                            <div class="timeline-content">
                                <h4>Order Completed</h4>
                                <p th:if="${order.status.name() == 'COMPLETED'}">
                                    Your digital downloads are now available
                                </p>
                                <p th:if="${order.status.name() == 'PENDING'}">
                                    Your order is being processed
                                </p>
                                <span class="timeline-date"
                                      th:if="${order.status.name() == 'COMPLETED'}"
                                      th:text="${#temporals.format(order.createdOn, 'dd MMM, yyyy - HH:mm')}">
                                </span>
                                <span class="timeline-date" th:if="${order.status.name() == 'PENDING'}">Pending</span>
                            </div>
                        </div>

                        <div class="timeline-item" th:if="${order.status.name() == 'COMPLETED'}">
                            <div class="timeline-marker"></div>
                            <div class="timeline-content">
                                <h4>Download Available</h4>
                                <p>All files are ready for download</p>
                                <span class="timeline-date">Ready</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="order-actions">
                <button class="reorder-btn"
                        th:if="${order.status.name() == 'COMPLETED'}">Reorder Items
                </button>
                <a th:href="@{/users/my-orders}" class="back-to-orders-btn">Back to Orders</a>
            </div>
        </div>
    </section>
</main>

<th:block th:replace="~{fragments/footer :: site-footer}"></th:block>

</body>

</html>
