<!DOCTYPE html>
<html lang="en" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
          rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" th:href="@{/css/common.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/profile.css}">
    <title th:text="#{profile.title} + ' | ' + #{header.music.store}"></title>
</head>

<body>

<th:block th:replace="~{fragments/header :: site-header}"></th:block>

<main>
    <div class="profile-header">
        <div class="container">
            <h1 class="page-title" th:text="#{profile.title}"></h1>
            <p class="page-subtitle" th:text="#{profile.subtitle}"></p>
        </div>
    </div>

    <section class="profile-section">
        <div class="container">
            <div class="profile-layout">
                <aside class="profile-sidebar">
                    <div class="profile-nav card">
                        <div class="profile-avatar-section">
                            <div class="profile-avatar">
                                <img th:src="${#strings.isEmpty(user.profilePicture)
                                    ? 'https://t4.ftcdn.net/jpg/09/43/48/93/360_F_943489384_zq3u5kkefFjPY3liE6t81KrX8W3lvxSz.jpg'
                                    : user.profilePicture}" alt="Profile Avatar">
                            </div>
                            <h3 class="profile-name" th:text="${user.username}"></h3>
                            <p class="profile-email" th:text="${user.email}"></p>
                            <button class="status-button active" th:if="${user.isActive()}"
                                    th:text="#{profile.status.active}"></button>
                            <button class="status-button inactive" th:if="${!user.isActive()}"
                                    th:text="#{profile.status.inactive}"></button>
                        </div>
                        <nav class="profile-menu">
                            <a th:href="@{/users/profile}" class="profile-menu-item active">
                                <span class="menu-icon">üë§</span>
                                <span th:text="#{profile.menu.personal.info}"></span>
                            </a>
                            <a th:href="@{/notifications}" class="profile-menu-item">
                                <span class="menu-icon">üß†</span>
                                <span th:text="#{profile.menu.notifications}"></span>
                            </a>
                            <a sec:authorize="hasRole('USER')"
                               th:href="@{/users/my-orders}" class="profile-menu-item">
                                <span class="menu-icon">üì¶</span>
                                <span th:text="#{profile.menu.my.orders}"></span>
                            </a>
                            <a href="/settings" class="profile-menu-item">
                                <span class="menu-icon">‚öôÔ∏è</span>
                                <span th:text="#{profile.menu.settings}"></span>
                            </a>
                        </nav>
                    </div>
                </aside>

                <div class="profile-content">
                    <div class="profile-info-card card">
                        <div class="card-header">
                            <h2 th:text="#{profile.personal.information}"></h2>
                            <form th:action="@{'/users/' + ${user.id} + '/profile'}"
                                  method="GET" th:object="${user}">
                                <button class="edit-button" th:text="#{profile.edit}"></button>
                            </form>
                        </div>

                        <div class="profile-info-grid">
                            <div class="info-group">
                                <label th:text="#{profile.first.name}"></label>
                                <p th:if="${#strings.isEmpty(user.firstName)}"
                                   th:text="#{profile.edit.add.first.name}">
                                </p>
                                <p th:unless="${#strings.isEmpty(user.firstName)}"
                                   th:text="${user.firstName}">
                                </p>
                            </div>
                            <div class="info-group">
                                <label th:text="#{profile.last.name}"></label>
                                <p th:if="${#strings.isEmpty(user.lastName)}"
                                   th:text="#{profile.edit.add.last.name}">
                                </p>
                                <p th:unless="${#strings.isEmpty(user.lastName)}"
                                   th:text="${user.lastName}">
                                </p>
                            </div>
                            <div class="info-group">
                                <label th:text="#{profile.email.address}"></label>
                                <p th:if="${#strings.isEmpty(user.email)}"
                                   th:text="#{profile.edit.add.email}">
                                </p>
                                <p th:unless="${#strings.isEmpty(user.email)}"
                                   th:text="${user.email}">
                                </p>
                            </div>
                            <div class="info-group">
                                <label th:text="#{profile.username}"></label>
                                <p th:text="${user.username}"></p>
                            </div>
                            <div class="info-group">
                                <label th:text="#{profile.date.of.birth}"></label>
                                <p th:if="${#strings.isEmpty(user.birthDate)}"
                                   th:text="#{profile.edit.add.birth.date}">
                                </p>

                                <p th:unless="${#strings.isEmpty(user.birthDate)}"
                                   th:text="${#temporals.format(user.birthDate, 'dd MMM, yyyy')}">
                                </p>
                            </div>
                            <div class="info-group">
                                <label th:text="#{profile.country}"></label>
                                <p th:text="${#strings.capitalize(#strings.toLowerCase(user.country))}"></p>
                            </div>
                            <div class="info-group full-width">
                                <label th:text="#{profile.bio}"></label>
                                <p th:if="${#strings.isEmpty(user.bio)}"
                                   th:text="#{profile.edit.write.bio}">
                                </p>
                                <p th:unless="${#strings.isEmpty(user.bio)}"
                                   th:text="${user.bio}">
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="stats-card card">
                        <div class="card-header">
                            <h2 th:text="#{profile.account.statistics}"></h2>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-icon">üéµ</div>
                                <div class="stat-content">
                                    <h3 th:text="#{profile.albums.purchased}"></h3>
                                    <p class="stat-number" th:text="${totalAlbumsPurchased}">0</p>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">üí∞</div>
                                <div class="stat-content">
                                    <h3 th:text="#{profile.totally.spent}"></h3>
                                    <p class="stat-number"
                                       th:text="${#numbers.formatDecimal(totalAmountSpent, 1, 2)} + ' ‚Ç¨'">
                                    </p>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">‚ù§Ô∏è</div>
                                <div class="stat-content">
                                    <h3 th:text="#{profile.wishlist.items}"></h3>
                                    <p class="stat-number">0</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="recent-activity-card card">
                        <div class="card-header">
                            <h2 th:text="#{profile.recent.activity}"></h2>
                            <a href="/my-orders" class="view-all-link" th:text="#{profile.view.all}"></a>
                        </div>
                        <div class="activity-list">
                            <div class="activity-item">
                                <div class="activity-icon">üõí</div>
                                <div class="activity-content">
                                    <h4 th:text="#{profile.purchase.completed}"></h4>
                                    <p>Midnight Dreams by The Night Owls</p>
                                    <span class="activity-date" th:text="#{profile.days.ago}"></span>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon">‚≠ê</div>
                                <div class="activity-content">
                                    <h4 th:text="#{profile.review.added}"></h4>
                                    <p th:text="#{profile.rated}"></p>
                                    <span class="activity-date" th:text="#{profile.week.ago}"></span>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon">‚ù§Ô∏è</div>
                                <div class="activity-content">
                                    <h4 th:text="#{profile.added.to.wishlist}"></h4>
                                    <p>Jazz Fusion by Modern Jazz Collective</p>
                                    <span class="activity-date" th:text="#{profile.weeks.ago}"></span>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon">üéµ</div>
                                <div class="activity-content">
                                    <h4 th:text="#{profile.download.completed}"></h4>
                                    <p>Acoustic Stories by Folk Masters</p>
                                    <span class="activity-date" th:text="#{profile.weeks.ago}"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<th:block th:replace="~{fragments/footer :: site-footer}"></th:block>

</body>

</html>
